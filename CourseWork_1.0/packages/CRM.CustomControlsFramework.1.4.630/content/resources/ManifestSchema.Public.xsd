<?xml version="1.0" encoding="utf-8"?>
<xs:schema attributeFormDefault="unqualified" elementFormDefault="qualified" xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <xs:group name="property-group-reference">
    <xs:choice>
      <xs:element maxOccurs="unbounded" minOccurs="0" name="property">
        <xs:complexType>
          <xs:choice maxOccurs="unbounded">
			<!-- enum values -->
            <xs:element minOccurs="0" maxOccurs="unbounded" name="value">
              <xs:complexType>
                <xs:simpleContent>
                  <xs:extension base="xs:string">
                    <xs:attribute name="name" type="xs:string" use="required" />
                    <xs:attribute name="display-name-key" type="xs:string" use="required" />
                    <xs:attribute name="description-key" type="xs:string" use="optional" />
                    <xs:attribute name="default" type="xs:string" use="optional" />
                  </xs:extension>
                </xs:simpleContent>
              </xs:complexType>
            </xs:element>
			<!-- end enum values -->
          </xs:choice>
          <xs:attribute name="name" type="xs:string" use="required" />
          <xs:attribute name="usage" type="usageType" use="optional" />
          <xs:attribute name="required" type="booleanType" use="optional" />
          <xs:attribute name="of-type" type="dataType" use="optional" />
          <xs:attribute name="of-type-group" type="xs:string" use="optional" />
          <xs:attribute name="display-name-key" type="xs:string" use="required" />
          <xs:attribute name="description-key" type="xs:string" use="optional" />
          <xs:attribute name="default-value" type="xs:string" use="optional" />
        </xs:complexType>
      </xs:element>
    </xs:choice>
  </xs:group>

  <xs:group name="data-set-group-reference">
    <xs:choice>
      <xs:element minOccurs="0" maxOccurs="unbounded" name="data-set">
        <xs:complexType>
          <xs:choice maxOccurs="unbounded">
            <xs:element maxOccurs="unbounded" minOccurs="0" name="property-set">
              <xs:complexType>
                <xs:attribute name="name" type="xs:string" use="required" />
                <xs:attribute name="usage" type="usageType" use="required" />
                <xs:attribute name="required" type="booleanType" use="optional" />
                <xs:attribute name="of-type-group" type="xs:string" use="optional" />
                <xs:attribute name="of-type" type="dataType" use="optional" />
                <xs:attribute name="description-key" type="xs:string" use="optional" />
                <xs:attribute name="display-name-key" type="xs:string" use="required" />
              </xs:complexType>
            </xs:element>
          </xs:choice>
          <xs:attribute name="name" type="xs:string" use="required" />
          <xs:attribute name="display-name-key" type="xs:string" use="required" />
          <xs:attribute name="description-key" type="xs:string" use="optional" />
        </xs:complexType>
      </xs:element>
    </xs:choice>
  </xs:group>

  <xs:element name="manifest">
    <xs:complexType>
      <xs:choice maxOccurs="unbounded">
        <!--Start of the control element definition-->
        <xs:element maxOccurs="unbounded" name="control">
          <xs:complexType>
            <xs:choice maxOccurs="unbounded">

              <!--Start of the type group element in control definition-->
              <xs:element minOccurs="0" maxOccurs="unbounded" name="type-group">
                <xs:complexType>
                  <xs:choice maxOccurs="unbounded">
                    <xs:element maxOccurs="unbounded" name="type" type="dataType" />
                  </xs:choice>
                  <xs:attribute name="name" type="xs:string" use="required" />
                </xs:complexType>
              </xs:element>
              <!--End of the type group element in control definition-->

              <!--Start of the property element in control definition-->
              <xs:group id="property" ref="property-group-reference"></xs:group>
              <!--End of the property element in control definition-->

              <!--Start of the data-set element in control definition-->
              <xs:group id="data-set" ref="data-set-group-reference"></xs:group>
              <!--End of the data-set element in control definition-->

              <!--Start of the resources element in control definition-->
              <xs:element minOccurs="1" name="resources">
                <xs:complexType>
                  <xs:choice maxOccurs="unbounded">
                    <xs:element name="library" minOccurs="0" maxOccurs="unbounded">
                      <xs:complexType>
                        <xs:sequence minOccurs="0" maxOccurs="unbounded">
                          <xs:element name="packaged_library">
                            <xs:complexType>
                              <xs:attribute name="path" type="xs:string" use="required" />
                              <xs:attribute name="version" type="xs:string" use="required" />
                            </xs:complexType>
                          </xs:element>
                        </xs:sequence>
                        <xs:attribute name="name" type="xs:string" use="required" />
                        <xs:attribute name="version" type="xs:string" use="required" />
                        <xs:attribute name="order" type="xs:positiveInteger" use="required" />
                      </xs:complexType>
                    </xs:element>
                    <xs:element name="code" minOccurs="1">
                      <xs:complexType>
                        <xs:attribute name="path" type="xs:string" use="required" />
                        <xs:attribute name="order" type="xs:positiveInteger" use="required" />
                      </xs:complexType>
                    </xs:element>
                    <xs:element name="css" minOccurs ="0">
                      <xs:complexType>
                        <xs:attribute name="path" type="xs:string" use="required" />
                        <xs:attribute name="order" type="xs:positiveInteger" use="optional" />
                      </xs:complexType>
                    </xs:element>
                    <xs:element name="img" minOccurs="0">
                      <xs:complexType>
                        <xs:attribute name="path" type="xs:string" use="required" />
                      </xs:complexType>
                    </xs:element>
                    <xs:element name="html" minOccurs="0">
                      <xs:complexType>
                        <xs:attribute name="path" type="xs:string" use="required" />
                        <xs:attribute name="order" type="xs:positiveInteger" use="optional" />
                      </xs:complexType>
                    </xs:element>
                    <xs:element name="resx" minOccurs="0" maxOccurs="unbounded">
                      <xs:complexType>
                        <xs:attribute name="path" type="xs:string" use="required" />
                        <xs:attribute name="version" type="xs:string" use="required" />
                      </xs:complexType>
                    </xs:element>
                  </xs:choice>
                </xs:complexType>
              </xs:element>
              <!--End of the resources element in control definition-->
            </xs:choice>

            <xs:attribute name="namespace" type="AlphaNumericType" use="required" />
            <xs:attribute name="constructor" type="AlphaNumericType" use="required" />
            <xs:attribute name="version" type="xs:string" use="required" />
            <xs:attribute name="preview-image" type="xs:string" use="optional" />
            <xs:attribute name="display-name-key" type="xs:string" use="required" />
            <xs:attribute name="description-key" type="xs:string" use="optional" />
            <xs:attribute name="control-type" type="controlType" use="optional" />
            <xs:attribute name="api-version" type="xs:string" use="optional" />
            <xs:attribute name="design-mapping-file" type="xs:string" use="optional" />
            <xs:attribute name="authoring-manifest" type="xs:string" use="optional" />
          </xs:complexType>

          <!--uniqueness of "name" attribute of property element-->
          <xs:unique name="uniqueProperty">
            <xs:selector xpath="./data-set | ./data-set/property-set | ./property | ./groups | ./groups/group | ./groups/group/data-set | ./groups/group/data-set/property-set | ./groups/group/property"/>
            <xs:field xpath="@name"/>
          </xs:unique>

        </xs:element>
        <!--End of the control definition-->

      </xs:choice>
      <xs:attribute name="schema-version" type="xs:string" use="optional" />
    </xs:complexType>
  </xs:element>
  <!--End of manifest definition-->

  <!--Restrictions on the boolean value-->
  <xs:simpleType name="booleanType">
    <xs:restriction base="xs:string">
      <xs:enumeration value="true" />
      <xs:enumeration value="false" />
    </xs:restriction>
  </xs:simpleType>

  <!--Restrictions on the Usage value-->
  <xs:simpleType name="usageType">
    <xs:restriction base="xs:string">
      <xs:enumeration value="bound" />
      <xs:enumeration value="input" />
      <xs:enumeration value="output" />
    </xs:restriction>
  </xs:simpleType>

  <!--Restrictions on the datatype value-->
  <xs:simpleType name="dataType">
    <xs:restriction base="xs:string">
      <xs:enumeration value="Whole.None" />
      <xs:enumeration value="TwoOptions" />
      <xs:enumeration value="DateAndTime.DateOnly" />
      <xs:enumeration value="DateAndTime.DateAndTime" />
      <xs:enumeration value="Decimal" />
      <xs:enumeration value="Enum" />
      <xs:enumeration value="FP" />
      <xs:enumeration value="Multiple" />
      <xs:enumeration value="Currency" />
      <xs:enumeration value="OptionSet" />
      <xs:enumeration value="SingleLine.Email" />
      <xs:enumeration value="SingleLine.Text" />
      <xs:enumeration value="SingleLine.TextArea" />
      <xs:enumeration value="SingleLine.URL" />
      <xs:enumeration value="SingleLine.Ticker" />
      <xs:enumeration value="SingleLine.Phone" />
    </xs:restriction>
  </xs:simpleType>
  <xs:simpleType name="controlType">
    <xs:restriction base="xs:string">
      <xs:enumeration value="virtual" />
      <xs:enumeration value="standard" />
    </xs:restriction>
  </xs:simpleType>
    <xs:simpleType name="AlphaNumericType">
        <xs:restriction base="xs:string">
            <xs:pattern value="[a-zA-Z0-9.]+"/>
        </xs:restriction>
    </xs:simpleType>
</xs:schema>
